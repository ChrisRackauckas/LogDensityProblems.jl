<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · LogDensityProblems.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>LogDensityProblems.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Home</a><ul class="internal"><li><a class="toctext" href="#Inference-1">Inference</a></li><li><a class="toctext" href="#Gradient-via-automatic-differentiation-1">Gradient via automatic differentiation</a></li><li><a class="toctext" href="#Transformed-problem-definition-1">Transformed problem definition</a></li><li><a class="toctext" href="#Benchmarking,-diagnostics,-and-utilities-1">Benchmarking, diagnostics, and utilities</a></li></ul></li><li><a class="toctext" href="internals/">Internals</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Home</a></li></ul><a class="edit-page" href="https://github.com/tpapp/LogDensityProblems.jl/blob/master/docs/src/index.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Introduction-1" href="#Introduction-1">Introduction</a></h1><p>This package provides the following functionality:</p><ol><li><p>It defines the <a href="#LogDensityProblems.logdensity"><code>logdensity</code></a> method with corresponding interface, which can be used by other packages that operate on (log) densities and need to evaluate the log densities or the gradients (eg <a href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">MCMC</a>, <a href="https://en.wikipedia.org/wiki/Maximum_a_posteriori_estimation">MAP</a>, <a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation">ML</a> or similar methods).</p></li><li><p>It defines the <a href="#LogDensityProblems.ADgradient"><code>ADgradient</code></a> which makes objects that support <code>logdensity</code> to calculate log density <em>values</em> calculate log density <em>gradients</em> using various automatic differentiation packages.</p></li><li><p>It defines the wrapper <a href="#LogDensityProblems.TransformedLogDensity"><code>TransformedLogDensity</code></a> using the <a href="https://github.com/tpapp/TransformVariables.jl">TransformVariables.jl</a> package, allowing callables that take a set of parameters transformed from a flat vector of real numbers to support the <code>logdensity</code> interface.</p></li><li><p>Various utility functions for debugging and testing log densities.</p></li></ol><h2><a class="nav-anchor" id="Inference-1" href="#Inference-1">Inference</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.logdensity" href="#LogDensityProblems.logdensity"><code>LogDensityProblems.logdensity</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">logdensity(resulttype, ℓ, x)</code></pre><p>Evaluate the <a href="internals/#LogDensityProblems.AbstractLogDensityProblem"><code>AbstractLogDensityProblem</code></a> <code>ℓ</code> at <code>x</code>, which has length compatible with its <a href="#TransformVariables.dimension"><code>dimension</code></a>.</p><p>The argument <code>resulttype</code> determines the type of the result:</p><ol><li><code>Real</code> for an unchecked evaluation of the log density which should return a <code>::Real</code></li></ol><p>number (that could be <code>NaN</code>, <code>Inf</code>, etc),</p><ol><li><p><a href="#LogDensityProblems.Value"><code>Value</code></a> for a checked log density, returning a <code>Value</code>,</p></li><li><p><a href="#LogDensityProblems.ValueGradient"><code>ValueGradient</code></a> also calculates the gradient, returning a <code>ValueGradient</code>,</p></li><li><p><a href="#LogDensityProblems.ValueGradientBuffer"><code>ValueGradientBuffer</code></a> calculates a <code>ValueGradient</code> <em>potentially</em> (but always</p></li></ol><p>consistently for argument types) using the provided buffer for the gradient. In this case, the element type of the array may determine the result element type.</p><p><strong>Implementation note</strong></p><p>Most types should just define the methods for <code>Real</code> and <code>ValueGradientBuffer</code> (when applicable), as <code>Value</code> and <code>ValueGradient</code> fall back to these, respectively.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/problem.jl#L19-L42">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TransformVariables.dimension" href="#TransformVariables.dimension"><code>TransformVariables.dimension</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">dimension(p)
</code></pre><p>The dimension of the problem, ie the length of the vectors in its domain.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/transformed.jl#L33">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.Value" href="#LogDensityProblems.Value"><code>LogDensityProblems.Value</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Value(value)
</code></pre><p>Holds the value of a logdensity at a given point.</p><p>Constructor ensures that the value is either finite, or <span>$-∞$</span>.</p><p>All other values (eg <code>NaN</code> or <code>Inf</code> for the <code>value</code>) lead to an error.</p><p>See also <a href="#LogDensityProblems.logdensity"><code>logdensity</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/result_types.jl#L37">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.ValueGradient" href="#LogDensityProblems.ValueGradient"><code>LogDensityProblems.ValueGradient</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">ValueGradient(value, gradient)
</code></pre><p>Holds the value and gradient of a logdensity at a given point.</p><p>Constructor ensures that either</p><ol><li><p>both the value and the gradient are finite,</p></li><li><p>the value is <span>$-∞$</span> (then gradient is not checked).</p></li></ol><p>All other values (eg <code>NaN</code> or <code>Inf</code> for the <code>value</code>) lead to an error.</p><p>See also <a href="#LogDensityProblems.logdensity"><code>logdensity</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/result_types.jl#L68">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.ValueGradientBuffer" href="#LogDensityProblems.ValueGradientBuffer"><code>LogDensityProblems.ValueGradientBuffer</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">struct ValueGradientBuffer{T&lt;:Real, V&lt;:AbstractArray{T&lt;:Real,1}}</code></pre><p>A wrapper for a vector that indicates that the vector <em>may</em> be used for the gradient in a <code>ValueGradient</code>. Consequences are undefined if it is modified later, implicitly the caller guarantees that it will not be used for anything else while the gradient is retrieved.</p><p>See <a href="#LogDensityProblems.logdensity"><code>logdensity</code></a>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/result_types.jl#L97">source</a></section><h2><a class="nav-anchor" id="Gradient-via-automatic-differentiation-1" href="#Gradient-via-automatic-differentiation-1">Gradient via automatic differentiation</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.ADgradient" href="#LogDensityProblems.ADgradient"><code>LogDensityProblems.ADgradient</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">ADgradient(kind, P; kwargs...)
</code></pre><p>Wrap <code>P</code> using automatic differentiation to obtain a gradient.</p><p><code>kind</code> is usually a <code>Val</code> type, containing a symbol that refers to a package. The symbol can also be used directly as eg</p><pre><code class="language-julia">ADgradient(:ForwardDiff, P)</code></pre><p>See <code>methods(ADgradient)</code>. Note that some methods are defined conditionally on the relevant package being loaded.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/AD.jl#L27">source</a><div><div><pre><code class="language-julia">ADgradient(#temp#, ℓ; chunk, gradientconfig)
</code></pre><p>Wrap a log density that supports evaluation of <code>Value</code> to handle <code>ValueGradient</code>, using <code>ForwardDiff</code>.</p><p>Keywords are passed on to <code>ForwardDiff.GradientConfig</code> to customize the setup. In particular, chunk size can be set with a <code>chunk</code> keyword argument (accepting an integer or a <code>ForwardDiff.Chunk</code>).</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/AD_ForwardDiff.jl#L24">source</a><div><div><pre><code class="language-julia">ADgradient(?, ℓ)
</code></pre><p>Gradient using algorithmic/automatic differentiation via Flux.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/AD_Flux.jl#L7">source</a></section><h2><a class="nav-anchor" id="Transformed-problem-definition-1" href="#Transformed-problem-definition-1">Transformed problem definition</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.TransformedLogDensity" href="#LogDensityProblems.TransformedLogDensity"><code>LogDensityProblems.TransformedLogDensity</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-none">TransformedLogDensity(transformation, log_density_function)</code></pre><p>A problem in Bayesian inference. Vectors of length <code>dimension(transformation)</code> are transformed into a general object <code>θ</code> (unrestricted type, but a named tuple is recommended for clean code), correcting for the log Jacobian determinant of the transformation.</p><p>It is recommended that <code>log_density_function</code> is a callable object that also encapsulates the data for the problem.</p><p><code>log_density_function(θ)</code> is expected to return <em>real numbers</em>. For zero densities or infeasible <code>θ</code>s, <code>-Inf</code> or similar should be returned, but for efficiency of inference most methods recommend using <code>transformation</code> to avoid this.</p><p>Use the property accessors <code>ℓ.transformation</code> and <code>ℓ.log_density_function</code> to access the arguments of <code>ℓ::TransformedLogDensity</code>, these are part of the API.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/transformed.jl#L7-L23">source</a></section><h2><a class="nav-anchor" id="Benchmarking,-diagnostics,-and-utilities-1" href="#Benchmarking,-diagnostics,-and-utilities-1">Benchmarking, diagnostics, and utilities</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.stresstest" href="#LogDensityProblems.stresstest"><code>LogDensityProblems.stresstest</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">stresstest(ℓ; N, rng, scale, resulttype)
</code></pre><p>Test <code>ℓ</code> with random values.</p><p><code>N</code> random vectors are drawn from a standard multivariate Cauchy distribution, scaled with <code>scale</code> (which can be a scalar or a conformable vector). In case the call produces an error, the value is recorded as a failure, which are returned by the function.</p><p>Not exported, but part of the API.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/stresstest.jl#L7">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.benchmark_ForwardDiff_chunks" href="#LogDensityProblems.benchmark_ForwardDiff_chunks"><code>LogDensityProblems.benchmark_ForwardDiff_chunks</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">benchmark_ForwardDiff_chunks(ℓ; chunks, resulttype, markprogress)
</code></pre><p>Benchmark a log density problem with various chunk sizes using ForwardDiff.</p><p><code>chunks</code>, which defaults to all possible chunk sizes, determines the chunks that are tried.</p><p>The function returns <code>chunk =&gt; time</code> pairs, where <code>time</code> is the benchmarked runtime in seconds, as determined by <code>BenchmarkTools.@belapsed</code>.</p><p><em>Runtime may be long</em> because of tuned benchmarks, so when <code>markprogress == true</code> (the  default), dots are printed to mark progress.</p><p>This function is not exported, but part of the API.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/AD_ForwardDiff.jl#L61">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.@iffinite" href="#LogDensityProblems.@iffinite"><code>LogDensityProblems.@iffinite</code></a> — <span class="docstring-category">Macro</span>.</div><div><div><p>If <code>expr</code> evaluates to a non-finite value, <code>return</code> with that, otherwise evaluate to that value. Useful for returning early from non-finite likelihoods.</p><p>Part of the API, but not exported.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/result_types.jl#L131">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="LogDensityProblems.LogDensityRejectErrors" href="#LogDensityProblems.LogDensityRejectErrors"><code>LogDensityProblems.LogDensityRejectErrors</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">LogDensityRejectErrors(ℓ)
</code></pre><p>Wrap a logdensity <code>ℓ</code> so that errors <code>&lt;: E</code> are caught and replaced with a <span>$-∞$</span> value.</p><p><code>E</code> defaults to <code>InvalidLogDensityExceptions</code>.</p><p><strong>Note</strong></p><p>Use cautiously, as catching errors can mask errors in your code. The recommended use case is for catching quirks and corner cases of AD. See also <a href="#LogDensityProblems.stresstest"><code>stresstest</code></a> as an alternative to using this wrapper.</p><p>Also, some AD packages don&#39;t handle <code>try</code> - <code>catch</code> blocks, so it is advised to use this as the outermost wrapper.</p></div></div><a class="source-link" target="_blank" href="https://github.com/tpapp/LogDensityProblems.jl/blob/7ea93f7a08b61064be018a1127262ff528a03217/src/reject_errors.jl#L11">source</a></section><footer><hr/><a class="next" href="internals/"><span class="direction">Next</span><span class="title">Internals</span></a></footer></article></body></html>
